# LaunchDB Environment Configuration
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control!

# ============================================================
# Database Configuration (REQUIRED)
# ============================================================

# PostgreSQL superuser password (REQUIRED)
POSTGRES_SUPERUSER_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# PostgreSQL superuser name (default: postgres)
POSTGRES_SUPERUSER=postgres

# Authenticator role password for PostgREST (REQUIRED)
AUTHENTICATOR_PASSWORD=CHANGE_ME_AUTHENTICATOR_PASSWORD

# PostgREST Manager read-only role password (REQUIRED)
POSTGREST_MANAGER_PASSWORD=CHANGE_ME_MANAGER_PASSWORD

# ============================================================
# Security & Encryption (REQUIRED)
# ============================================================

# Master encryption key (32 bytes, base64) - REQUIRED
# Generate: openssl rand -base64 32
LAUNCHDB_MASTER_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL

# Platform JWT secret - REQUIRED
# Generate: openssl rand -base64 32
PLATFORM_JWT_SECRET=CHANGE_ME_GENERATE_WITH_OPENSSL

# PostgREST JWT secret - REQUIRED
# Generate: openssl rand -base64 32
POSTGREST_JWT_SECRET=CHANGE_ME_GENERATE_WITH_OPENSSL

# Internal API key for service-to-service auth - REQUIRED
# Generate: openssl rand -hex 32
INTERNAL_API_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL

# PostgREST admin key - REQUIRED
# Generate: openssl rand -hex 32
POSTGREST_ADMIN_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL

# Backup encryption key (GPG passphrase) - REQUIRED
# Generate: openssl rand -base64 32
BACKUP_ENCRYPTION_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL

# ============================================================
# Domain & TLS (REQUIRED)
# ============================================================

# Your domain - REQUIRED
DOMAIN=api.example.com

# Email for Let's Encrypt - REQUIRED
ACME_EMAIL=admin@example.com

# ============================================================
# Application Configuration (REQUIRED)
# ============================================================

# CORS allowed origins - REQUIRED
# Development: http://localhost:3000
# Production: https://app.yourdomain.com
# NEVER use '*' in production (security risk)
CORS_ORIGIN=https://app.yourdomain.com

# ============================================================
# SMTP / Email (Optional - required for auth emails)
# ============================================================

# Production SMTP
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=noreply@example.com
SMTP_PASSWORD=smtp_password_here
SMTP_FROM=noreply@example.com

# Development: Use Mailhog or similar
# SMTP_HOST=mailhog
# SMTP_PORT=1025

# ============================================================
# Backup Configuration (Optional)
# ============================================================

# Backup retention in days (default: 7)
BACKUP_RETENTION_DAYS=7

# Remote rsync destination (optional, recommended)
# Format: user@host:/path
# Example: backup-user@backup.example.com:/var/backups/launchdb
RSYNC_DEST=

# SSH key path for rsync (default: /root/.ssh/backup_key)
RSYNC_SSH_KEY_PATH=/root/.ssh/backup_key

# ============================================================
# Storage Configuration (Optional)
# ============================================================

# Max file upload size in MB (default: 50)
MAX_FILE_SIZE_MB=50

# Signed URL TTL in seconds (default: 3600)
SIGNED_URL_TTL=3600

# ============================================================
# Port Configuration (Optional)
# ============================================================

# HTTP/HTTPS ports (default: 80/443)
# Change these if ports 80/443 are already in use
LAUNCHDB_HTTP_PORT=80
LAUNCHDB_HTTPS_PORT=443

# ============================================================
# Cloudflare Tunnel (Optional)
# ============================================================

# Cloudflare Tunnel token (only if using Cloudflare Tunnel)
# Leave empty for standard installation
# Get token from: docker run --rm -v /opt/launchdb/.cloudflared:/etc/cloudflared cloudflare/cloudflared:latest tunnel token <TUNNEL_ID>
CLOUDFLARE_TUNNEL_TOKEN=

# ============================================================
# Logging & Debugging (Optional)
# ============================================================

# Log level: error, warn, info, debug (default: info)
LOG_LEVEL=info

# Node environment (default: production)
NODE_ENV=production

# ============================================================
# Advanced Configuration (Optional)
# ============================================================

# Database host (default: postgres)
POSTGRES_HOST=postgres

# Database port (default: 5432)
POSTGRES_PORT=5432

# PgBouncer config directory (default: /etc/pgbouncer)
PGBOUNCER_CONFIG_DIR=/etc/pgbouncer

# PostgREST config directory (default: /etc/postgrest)
POSTGREST_CONFIG_DIR=/etc/postgrest

# ============================================================
# PostgREST Manager Configuration (REQUIRED)
# ============================================================

# REQUIRED: Host paths for Docker daemon to mount volumes
# These MUST be absolute paths on the Docker host where files are located
# Update these values to match your actual deployment directory
#
# Example for /opt/launchdb deployment:
#   HOST_SCRIPT_DIR=/opt/launchdb/scripts
#   HOST_CONFIG_DIR=/opt/launchdb/postgrest/projects
#
# IMPORTANT: Update these example defaults to match your actual deployment path
# Example shown for /opt/launchdb - change if you deployed elsewhere
HOST_SCRIPT_DIR=/opt/launchdb/infrastructure/scripts
HOST_CONFIG_DIR=/opt/launchdb/infrastructure/postgrest/projects

# ============================================================
# Quick Setup Commands
# ============================================================

# 1. Copy this file:
#    cp .env.example .env

# 2. Generate secrets:
#    export LAUNCHDB_MASTER_KEY=$(openssl rand -base64 32)
#    export PLATFORM_JWT_SECRET=$(openssl rand -base64 32)
#    export POSTGREST_JWT_SECRET=$(openssl rand -base64 32)
#    export INTERNAL_API_KEY=$(openssl rand -hex 32)
#    export POSTGREST_ADMIN_KEY=$(openssl rand -hex 32)
#    export BACKUP_ENCRYPTION_KEY=$(openssl rand -base64 32)

# 3. Update .env with generated values

# 4. Set strong database password:
#    export POSTGRES_SUPERUSER_PASSWORD=$(openssl rand -base64 24)
#    export AUTHENTICATOR_PASSWORD=$(openssl rand -base64 24)

# 5. Update DOMAIN and ACME_EMAIL

# 6. Start services:
#    docker compose up -d
