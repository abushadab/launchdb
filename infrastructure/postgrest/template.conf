# PostgREST Configuration Template
# This template is used by postgrest-add-project.sh to generate per-project configs
#
# See: https://postgrest.org/en/stable/references/configuration.html
# Contract: interfaces.md Section 2

# Database connection (via PgBouncer)
db-uri = "postgres://{{DB_USER}}:{{DB_PASSWORD}}@pgbouncer:6432/{{DB_NAME}}"
db-schemas = "public,storage"
db-anon-role = "anon"
db-pool = 10
db-pool-acquisition-timeout = 10

# Disable prepared statements for PgBouncer transaction pooling compatibility
# PgBouncer in transaction mode reuses connections across transactions
# Prepared statements would persist and cause "already exists" errors
# See: https://postgrest.org/en/stable/references/configuration.html#db-prepared-statements
db-prepared-statements = false

# JWT settings (per interfaces.md section 1)
jwt-secret = "{{JWT_SECRET}}"
jwt-aud = "authenticated"

# Server settings
server-port = 3000

# OpenAPI
openapi-server-proxy-uri = "https://{{DOMAIN}}/db/{{PROJECT_ID}}"

# Limits (per interfaces.md section 2)
max-rows = 1000

# Logging
log-level = "info"

# Variables to replace:
# {{PROJECT_ID}}    - Project identifier (e.g., proj_abc123)
# {{DB_NAME}}       - Database name (same as PROJECT_ID)
# {{DB_USER}}       - Authenticator role ({PROJECT_ID}_authenticator)
# {{DB_PASSWORD}}   - Authenticator password
# {{JWT_SECRET}}    - Per-project JWT secret (from platform.secrets)
# {{DOMAIN}}        - Public domain

# Note: Uses global roles (anon, authenticated, service_role)
# DB connection routed through PgBouncer for connection pooling
